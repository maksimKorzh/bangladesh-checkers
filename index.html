<div id="board"></div>
<style>
  .highlight { box-shadow: inset 0px 0px 3px 3px #ff3300; }
  .mate { box-shadow: inset 0px 0px 5px 5px red; }
</style>
<script>
  /*var board = [
    3, 3, 3, 3, 3, 3, 3,
    3, 2, 2, 2, 2, 2, 3,
    3, 2, 2, 2, 2, 2, 3,
    3, 2, 2, 2, 2, 2, 3,
    3, 0, 0, 0, 0, 0, 3,
    3, 0, 0, 0, 0, 0, 3,
    3, 1, 1, 1, 1, 1, 3,
    3, 1, 1, 1, 1, 1, 3,
    3, 1, 1, 1, 1, 1, 3,
    3, 3, 3, 3, 3, 3, 3,
  ];*/
  
  var board = [
    3, 3, 3, 3, 3, 3, 3,
    3, 0, 0, 0, 0, 0, 3,
    3, 0, 0, 0, 0, 0, 3,
    3, 0, 0, 2, 0, 0, 3,
    3, 0, 0, 0, 0, 0, 3,
    3, 0, 0, 2, 0, 0, 3,
    3, 0, 0, 1, 1, 0, 3,
    3, 0, 0, 0, 0, 0, 3,
    3, 0, 0, 0, 0, 0, 3,
    3, 3, 3, 3, 3, 3, 3,
  ];
  
  var side = 1;
  var clickLock = 0;
  var userSrc, userDst;
  var moves = [];
  
  function printBoard() {
    let boardStr = '';
    for (let row = 0; row < 9; row++) {
      for (let col = 0; col < 7; col++) {
        let sq = row * 7 + col;
        if (board[sq] == 3) continue;
        boardStr += ['.', 'E', 'L'][board[sq]]
      } boardStr += '\n';
    } console.log(boardStr);
  }

  function drawBoard() {
    let boardHTML = `<table bgcolor="#996633" align="center" cellspacing="1" `;
    boardHTML += `style=" -moz-user-select: none; -webkit-user-select: none; -ms-user-select: none;`;
    boardHTML += `user-select: none; -o-user-select: none; border: 10px solid #996633;"`;
    boardHTML += `unselectable="on" onselectstart="return false;" onmousedown="return false;"`;
    for (let row = 0; row < 9; row++) {
      boardHTML+= '<tr>';
      for (let col = 0; col < 7; col++) {
        let sq = row * 7 + col;
        if (board[sq] == 3) continue;
        boardHTML+= '<td align="center" id="' + sq + 
             '" width="65" height="65" style="font-size: 45px; border: 1px solid black;"' +
             ' onclick="userMove(this.id)">' + [' ', '\uD83E\uDD5A', '\uD83C\uDF4B'][board[sq]] +
             '</td>';
      } boardHTML+= '</tr>';
    } boardHTML+= '</table>';
    document.getElementById('board').innerHTML = boardHTML;
  } drawBoard();

  function generateMoves() {
    let moves = [];
    let srcSq, dstSq, capSq, pce, capPce;
    for (let sq = 0; sq < board.length; sq++) {
      if (board[sq] == 3) continue;
      srcSq = sq;
      pce = board[srcSq];
      if (pce != side) continue;
      for (let dir of [+1, -1, +7, -7]) {
        dstSq = srcSq + dir;
        capSq = dstSq;
        if (board[capSq] == side || board[capSq] == 3) continue;
        if (board[capSq] == (3-side)) {
          if (board[capSq + dir] == 0) dstSq = capSq + dir;
          else continue;
        }
        capPce = board[capSq];
        moves.push([srcSq, dstSq, capSq, pce, capPce]);
      }
    } return moves;
  }
  
  function makeMove(move) {
    console.log(move);
    board[move[2]] = 0;
    board[move[1]] = move[3];
    board[move[0]] = 0;
    side = 3 - side;
  }
  
  function takeBack(move) {
    board[move[0]] = move[3];
    board[move[1]] = 0;
    board[move[2]] = move[4];
    side = 3 - side;
  }
  
  function userMove(sq) {
    var clickSq = parseInt(sq, 10);
    if (!clickLock && board[clickSq]) {
      for (let sq = 0; sq < board.length; sq++)
        if (board[sq] != 3) document.getElementById(clickSq).classList.remove('highlight');
      document.getElementById(clickSq).classList.add('highlight');
      moves = generateMoves();
      for (let move of moves)
        if (clickSq == move[0]) {
          document.getElementById(move[1]).classList.add('highlight');
          userSrc = clickSq;
        }
      clickLock = 1;
    } else if (clickLock) {
      userDst = clickSq;
      for (let move of moves)
        if (userSrc == move[0] && userDst == move[1]) makeMove(move);
      drawBoard();
      clickLock = 0;
    }
  }
</script>
