<body style="font-family: monospace; font-size: 20px;">
  <div id="board"></div>
  <div style="display: flex; justify-content: center; gap: 5px; margin-top: 10px;">
    <button id="undo">Undo</button>
    <button id="move">Move</button>
    <button id="flip">Flip</button>
  </div>
  <style>
    .highlight { box-shadow: inset 0px 0px 3px 3px #ff3300; }
    .mate { box-shadow: inset 0px 0px 5px 5px red; }
    button { font-size: inherit; font-family: inherit; }
  </style>
</body>
<script>
  var board = [
    3, 3, 3, 3, 3, 3, 3,
    3, 2, 2, 2, 2, 2, 3,
    3, 2, 2, 2, 2, 2, 3,
    3, 2, 2, 2, 2, 2, 3,
    3, 0, 0, 0, 0, 0, 3,
    3, 0, 0, 0, 0, 0, 3,
    3, 1, 1, 1, 1, 1, 3,
    3, 1, 1, 1, 1, 1, 3,
    3, 1, 1, 1, 1, 1, 3,
    3, 3, 3, 3, 3, 3, 3,
  ];
  
  var pst = [
    0,  3,  3,  3,  3,  3,  0,
    0, -1, -1, -1, -1, -1,  0,
    0, -1, -1, -1, -1, -1,  0,
    0, -1, -1, -1, -1, -1,  0,
    0,  1,  2,  3,  2,  1,  0,
    0,  1,  2,  3,  2,  1,  0,
    0, -1, -1, -1, -1, -1,  0,
    0, -1, -1, -1, -1, -1,  0,
    0, -1, -1, -1, -1, -1,  0,
    0,  0,  0,  0,  0,  0,  0,
  ];
  
  var side = 1;
  var clickLock = 0;
  var flip = 0;
  var userSrc, userDst;
  var legalMoves = [];
  var gameMoves = [];
  
  function drawBoard() {
    let boardHTML = `<table bgcolor="#996633" align="center" cellspacing="1" `;
    boardHTML += `style=" -moz-user-select: none; -webkit-user-select: none; -ms-user-select: none;`;
    boardHTML += `user-select: none; -o-user-select: none; border: 10px solid #996633;"`;
    boardHTML += `unselectable="on" onselectstart="return false;" onmousedown="return false;"`;
    for (let row = 0; row < 9; row++) {
      boardHTML+= '<tr>';
      for (let col = 0; col < 7; col++) {
        let file, rank;
        if (flip) {
          file = 7-1-col;
          rank = 10-1-row;
        } else {
          file = col;
          rank = row;
        }
        let sq = rank * 7 + file;
        if (board[sq] == 3) continue;
        boardHTML+= '<td align="center" id="' + sq + 
             '" width="65" height="65" style="font-size: 45px; border: 1px solid black;"' +
             ' onclick="userMove(this.id)">' + [' ', '\uD83E\uDD5A', '\uD83C\uDF4B'][board[sq]] +
             '</td>';
      } boardHTML+= '</tr>';
    } boardHTML+= '</table>';
    document.getElementById('board').innerHTML = boardHTML;
  } drawBoard();

  function generateMoves() {
    let moves = [];
    let srcSq, dstSq, capSq, pce, capPce;
    for (let sq = 0; sq < board.length; sq++) {
      if (board[sq] == 3) continue;
      srcSq = sq;
      pce = board[srcSq];
      if (pce != side) continue;
      for (let dir of [+1, -1, +7, -7]) {
        dstSq = srcSq + dir;
        capSq = dstSq;
        if (board[capSq] == side || board[capSq] == 3) continue;
        if (board[capSq] == (3-side)) {
          if (board[capSq + dir] == 0) dstSq = capSq + dir;
          else continue;
        }
        capPce = board[capSq];
        moves.push([srcSq, dstSq, capSq, pce, capPce]);
      }
    } return moves;
  }
  
  function makeMove(move) {
    board[move[2]] = 0;
    board[move[1]] = move[3];
    board[move[0]] = 0;
    side = 3 - side;
  }
  
  function takeBack(move) {
    board[move[0]] = move[3];
    board[move[1]] = 0;
    board[move[2]] = move[4];
    side = 3 - side;
  }
  
  function evaluate() {
    let score = 0;
    for (let sq = 0; sq < board.length; sq++) {
      if (board[sq] == 3) continue;
      if (board[sq] == 1) score += 1 + pst[sq];
      if (board[sq] == 2) score -= 1 + pst[sq];
    } return (side == 1) ? score : -score
  }

  function search(depth, alpha = -Infinity, beta = Infinity) {
    let oldSide = side;
    let bestMove = null;
    const originalDepth = depth;
    function negamax(depth, alpha, beta) {
      if (depth === 0) return evaluate(oldSide);
      let bestScore = -Infinity;
      const moves = generateMoves();
      if (moves.length === 0) return -Infinity;
      for (const move of moves) {
        let prevSide = side;
        makeMove(move);
        let score = -negamax(depth - 1, -beta, -alpha);
        if (move[4]) score += 2 * depth;
        takeBack(move);
        if (score > bestScore) {
          bestScore = score;
          if (depth === originalDepth) bestMove = move;
        } alpha = Math.max(alpha, bestScore);
        if (alpha >= beta) break;
      } return bestScore;
    }
    const bestScore = negamax(depth, alpha, beta);
    side = oldSide;
    return { bestScore, bestMove };
  }
  
  function userMove(sq) {
    var clickSq = parseInt(sq, 10);
    if (!clickLock && board[clickSq]) {
      for (let sq = 0; sq < board.length; sq++)
        if (board[sq] != 3) document.getElementById(clickSq).classList.remove('highlight');
      document.getElementById(clickSq).classList.add('highlight');
      legalMoves = generateMoves();
      for (let move of legalMoves)
        if (clickSq == move[0]) {
          document.getElementById(move[1]).classList.add('highlight');
          userSrc = clickSq;
        }
      clickLock = 1;
    } else if (clickLock) {
      userDst = clickSq;
      for (let move of legalMoves)
        if (userSrc == move[0] && userDst == move[1]) {
          makeMove(move);
          gameMoves.push(move);
          let response = search(6);
          makeMove(response.bestMove);
          gameMoves.push(response.bestMove);
        }
      drawBoard();
      clickLock = 0;
    }
  }
  
  document.getElementById('undo').addEventListener('click', () => {
    if (!gameMoves.length) return;
    takeBack(gameMoves[gameMoves.length-1]);
    gameMoves.pop();
    drawBoard();
  });
  
  document.getElementById('move').addEventListener('click', () => {
    let response = search(6);
    makeMove(response.bestMove);
    gameMoves.push(response.bestMove);
    drawBoard();
  });
  
  document.getElementById('flip').addEventListener('click', () => {
    flip ^= 1;
    drawBoard();
  });
</script>
